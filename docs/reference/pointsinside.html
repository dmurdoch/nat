<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find which points of an object are inside a surface — pointsinside • nat</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Find which points of an object are inside a surface — pointsinside" />
<meta property="og:description" content="Find which points of an object are inside a surface" />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.10.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/neurons-intro.html">Introduction to neurons and neuronlists</a>
    </li>
    <li>
      <a href="../articles/neurons-as-graph.html">Working with individual neurons as graph structures</a>
    </li>
    <li>
      <a href="../articles/plotly.html">3D graphics</a>
    </li>
    <li>
      <a href="../articles/NeuroGeometry.html">NeuroGeometry: Analysing 3D morphology of neurons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/Installation.html">Installation</a>
</li>
<li>
  <a href="../index.html#learn">Learn</a>
</li>
<li>
  <a href="../index.html#help">Help</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://natverse.github.io">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/nat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find which points of an object are inside a surface</h1>
    <small class="dont-index">Source: <a href='https://github.com/natverse/nat/blob/master/R/hxsurf.R'><code>R/hxsurf.R</code></a></small>
    <div class="hidden name"><code>pointsinside.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Find which points of an object are inside a surface</p>
    </div>

    <pre class="usage"><span class='fu'>pointsinside</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>surf</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for default</span>
<span class='fu'>pointsinside</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>surf</span>,
  <span class='va'>...</span>,
  rval <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"logical"</span>, <span class='st'>"distance"</span>, <span class='st'>"mesh3d"</span>, <span class='st'>"consistent_logical"</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>an object with 3D points.</p></td>
    </tr>
    <tr>
      <th>surf</th>
      <td><p>The reference surface - either a <code>mesh3d</code> object or any
object that can be converted using <code>as.mesh3d</code> including <code>hxsurf</code>
and <code>ashape3d</code> objects.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments for methods, eventually passed to
<code><a href='as.mesh3d.html'>as.mesh3d</a></code>.</p></td>
    </tr>
    <tr>
      <th>rval</th>
      <td><p>what to return.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A vector of logical values or distances (positive inside, negative
  outside) equal to the number of points in x or the <code>mesh3d</code> object
  returned by <code><a href='https://rdrr.io/pkg/Rvcg/man/vcgClostKD.html'>Rvcg::vcgClostKD</a></code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note that <code>hxsurf</code> surface objects will be converted to
  <code>mesh3d</code> before being passed to <code><a href='https://rdrr.io/pkg/Rvcg/man/vcgClostKD.html'>Rvcg::vcgClostKD</a></code>, so if you are
  testing repeatedly against the same surface, it may make sense to
  pre-convert.</p>
<p><code>pointsinside</code> depends on the face normals for each face pointing out
  of the object (see example). The face normals are defined by the order of
  the three vertices making up a triangular face. You can flip the face
  normal for a face by permuting the vertices (i.e. 1,2,3 -&gt; 1,3,2). If you
  find for a given surface that points are outside when you expect them to be
  inside then the face normals are probably all the wrong way round. You can
  invert them yourself or use the <code><a href='https://rdrr.io/pkg/Morpho/man/invertFaces.html'>Morpho::invertFaces</a></code> function to fix
  this.</p>
<p>The <code>rval</code> argument determines the return value. These options should
  be fairly clear, but the difference between <code>logical</code> and
  <code>consistent_logical</code> needs some explanation. The <code>logical</code> method
  now does a pre-test to remove any points that are not in the 3D bounding
  box (cuboid) enclosing the surf object. This often results in a significant
  speed-up by rejecting distant points and has the additional benefit of
  rejecting distant points that sometimes are erroneously declared inside the
  mesh (see below). Regrettably it is not yet possible to extend this
  approach when distances are being returned, which means there will be a
  discrepancy between the results of <code>rval="logical"</code> and looking for
  points with distance &gt;=0. If you want to ensure consistency between these
  approaches, use <code>rval="consistent_logical"</code>.</p>
<p>If you find that some points but not all points are not behaving as you
  would expect, then it may be that some faces are not coherently oriented.
  The <code>Rvcg::<a href='https://rdrr.io/pkg/Rvcg/man/vcgClean.html'>vcgClean</a></code> function can sometimes be used to
  correct the orientation of the faces. Fixing more problematic cases may be
  possible by generating a new surface using
  <code>alphashape3d::<a href='https://rdrr.io/pkg/alphashape3d/man/ashape3d.html'>ashape3d</a></code> (see examples).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># check if the vertices in these neurons are inside the mushroom body calyx</span>
<span class='co'># surface object</span>
<span class='va'>inout</span><span class='op'>=</span><span class='fu'>pointsinside</span><span class='op'>(</span><span class='va'>kcs20</span>, surf<span class='op'>=</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>inout</span><span class='op'>)</span>
</div><div class='output co'>#&gt; inout
#&gt; FALSE  TRUE 
#&gt;  6530  1991 </div><div class='input'><span class='co'># you can also check if points are inside a bounding box</span>
<span class='va'>mbcalbb</span><span class='op'>=</span><span class='fu'><a href='boundingbox.html'>boundingbox</a></span><span class='op'>(</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>inout2</span><span class='op'>=</span><span class='fu'>pointsinside</span><span class='op'>(</span><span class='va'>kcs20</span>, <span class='va'>mbcalbb</span><span class='op'>)</span>
<span class='co'># compare those two</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>inout</span>, <span class='va'>inout2</span><span class='op'>)</span>
</div><div class='output co'>#&gt;        inout2
#&gt; inout   FALSE TRUE
#&gt;   FALSE  5691  839
#&gt;   TRUE      0 1991</div><div class='input'><span class='va'>pts</span><span class='op'>=</span><span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span><span class='op'>(</span><span class='va'>kcs20</span><span class='op'>)</span>
<span class='co'># nb that colour expressions maps combinations of two logicals onto 1:4</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>pts</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>, col<span class='op'>=</span><span class='fl'>1</span><span class='op'>+</span><span class='va'>inout</span><span class='op'>+</span><span class='va'>inout2</span><span class='op'>*</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='img'><img src='pointsinside-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># the colours are defined by</span>
<span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>]</span>
</div><div class='output co'>#&gt; [1] "black"   "#DF536B" "#61D04F" "#2297E6"</div><div class='input'>
<span class='co'># be a bit more lenient and include points less than 5 microns from surface</span>
<span class='va'>MBCAL</span><span class='op'>=</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span><span class='op'>)</span>
<span class='va'>inout5</span><span class='op'>=</span><span class='fu'>pointsinside</span><span class='op'>(</span><span class='va'>kcs20</span>, surf<span class='op'>=</span><span class='va'>MBCAL</span>, rval<span class='op'>=</span><span class='st'>'distance'</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='op'>-</span><span class='fl'>5</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>inout5</span><span class='op'>)</span>
</div><div class='output co'>#&gt; inout5
#&gt; FALSE  TRUE 
#&gt;  5604  2917 </div><div class='input'><span class='co'># \donttest{</span>
<span class='co'># show which points are in or out</span>
<span class='co'># Hmm seems like there are a few red points in the vertical lobe</span>
<span class='co'># that are well outside the calyx</span>
<span class='fu'>points3d</span><span class='op'>(</span><span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span><span class='op'>(</span><span class='va'>kcs20</span><span class='op'>)</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>inout5</span>, <span class='st'>'red'</span>, <span class='st'>'black'</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='plot3d.html'>plot3d</a></span><span class='op'>(</span><span class='va'>MBL.surf</span>, alpha<span class='op'>=</span><span class='fl'>.3</span><span class='op'>)</span>

<span class='co'># Let's try to make an alphashape for the mesh to clean it up</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>alphashape3d</span><span class='op'>)</span>
<span class='va'>MBCAL.as</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/alphashape3d/man/ashape3d.html'>ashape3d</a></span><span class='op'>(</span><span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span><span class='op'>(</span><span class='va'>MBCAL</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
<span class='co'># Plotting the points, we can see that is much better behaved</span>
<span class='fu'>points3d</span><span class='op'>(</span><span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span><span class='op'>(</span><span class='va'>kcs20</span><span class='op'>)</span>,
  col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'>pointsinside</span><span class='op'>(</span><span class='va'>kcs20</span>, <span class='va'>MBCAL.as</span><span class='op'>)</span>, <span class='st'>'red'</span>, <span class='st'>'black'</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># }</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Show the face normals for a surface</span>
<span class='kw'>if</span><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/zarquon42b/Morpho'>'Morpho'</a></span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># convert to a mesh3d object used by rgl and Morpho packge</span>
  <span class='va'>MBCAL.mesh</span><span class='op'>=</span><span class='fu'><a href='as.mesh3d.html'>as.mesh3d</a></span><span class='op'>(</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>fn</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/Morpho/man/updateNormals.html'>facenormals</a></span><span class='op'>(</span><span class='va'>MBCAL.mesh</span><span class='op'>)</span>
  <span class='fu'><a href='wire3d.html'>wire3d</a></span><span class='op'>(</span><span class='va'>MBCAL.mesh</span><span class='op'>)</span>
  <span class='co'># show that the normals point out of the object</span>
  <span class='fu'><a href='https://rdrr.io/pkg/Morpho/man/plotNormals.html'>plotNormals</a></span><span class='op'>(</span><span class='va'>fn</span>, long<span class='op'>=</span><span class='fl'>5</span>, col<span class='op'>=</span><span class='st'>'red'</span><span class='op'>)</span>

  <span class='co'># invert the faces of the mesh and show that normals point in</span>
  <span class='va'>MBCAL.inv</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/Morpho/man/invertFaces.html'>invertFaces</a></span><span class='op'>(</span><span class='va'>MBCAL.mesh</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/pkg/Morpho/man/plotNormals.html'>plotNormals</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/Morpho/man/updateNormals.html'>facenormals</a></span><span class='op'>(</span><span class='va'>MBCAL.inv</span><span class='op'>)</span>, long<span class='op'>=</span><span class='fl'>5</span>, col<span class='op'>=</span><span class='st'>'cyan'</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton, Sridhar Jagannathan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


